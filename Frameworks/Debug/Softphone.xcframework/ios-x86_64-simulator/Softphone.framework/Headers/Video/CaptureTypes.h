//
//  CaptureTypes.h
//  libsoftphone
//
//  Copyright (c) 2012 - 2017 Acrobits, s.r.o. All rights reserved.
//

#pragma once

#include "ali/ali_string.h"
#include "ali/ali_geometry.h"

namespace Video
{
namespace Capture
{

//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
struct CameraPosition
//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
{
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    enum Type
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        Unknown = -1,
        Front,
        Back,
        Virtual
    };

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    friend void swap(Type & x, Type & y)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        ali::swap_by_copy(x, y);
    }
};

//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
struct Rotation
//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
{
    enum Type
    {
        Unknown = -1,
        Rotate_0,
        Rotate_90,
        Rotate_180,
        Rotate_270
    };

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    static int toDegrees(Rotation::Type rot)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        switch(rot)
        {
        case Rotate_0:
            return 0;

        case Rotate_90:
            return 90;

        case Rotate_180:
            return 180;

        case Rotate_270:
            return 270;

        case Unknown:
            break;
        }
        ali_assert(false);
        return -1;
    }

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    static Type fromDegrees(int degrees)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        switch (degrees)
        {
        case 270:
            return Rotate_270;

        case 180:
            return Rotate_180;

        case 90:
            return Rotate_90;

        case 0:
            return Rotate_0;
        }

        ali_assert(false);
        return Unknown;
    }

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    static Type inverse(Type rot)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        switch(rot)
        {
        case Rotate_0:
            return Rotate_0;

        case Rotate_90:
            return Rotate_270;

        case Rotate_180:
            return Rotate_180;

        case Rotate_270:
            return Rotate_90;

        case Unknown:
            break;
        }
        ali_assert(false);
        return Unknown;
    }

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    friend void swap(Type & x, Type & y)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        ali::swap_by_copy(x, y);
    }
};

//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
struct CameraInfo
//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
{
    ali::string             id;
    ali::string             name;

    CameraPosition::Type    position{CameraPosition::Unknown};
    bool                    hasFlash{false};
    bool                    hasTorch{false};
    Rotation::Type          orientation{Rotation::Rotate_0};

    bool operator ==(CameraInfo const& other) const { return id == other.id; }
    bool operator !=(CameraInfo const& other) const { return id != other.id; }
    bool operator <(CameraInfo const& other) const { return id < other.id; }

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    friend int compare(CameraInfo const& i1, CameraInfo const& i2)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        using ali::compare;
        return compare(i1.id, i2.id);
    }

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    friend void swap(CameraInfo & i1, CameraInfo & i2)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        i1.swap(i2);
    }

    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    void swap(CameraInfo & i)
    //*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
    {
        using ali::swap;
        swap(id, i.id);
        swap(name, i.name);
        swap(position, i.position);
        swap(hasFlash, i.hasFlash);
        swap(hasTorch, i.hasTorch);
        swap(orientation, i.orientation);
    }
};

// The transform defines how to get the final rectangle from the native video
// format. First scale the native rect to scaledSize, then crop cropRectangle out of it,
// finally rotate  by rotation.
//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
struct Transform
//*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
{
    ali::size<int>   nativeResolution{};
    ali::size<int>   scaledSize{};
    ali::rect<int>   cropRectangle{};
    Rotation::Type   rotation{Rotation::Unknown};
};

}
}
